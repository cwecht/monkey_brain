<?xml version="1.0"?>
<!--
 we test 'optimally enabled set', specifically that preemption works correctly 
-->
<scxml initial="s0" version="1.0">
  <state id="s0" initial="p0">
    <onentry>
      <raise event="event1"/>
    </onentry>
    <transition event="event2" target="conf:fail"/>
    <parallel id="p0">
      <state id="p0s1">
        <transition event="event1"/>
        <transition event="event2"/>
      </state>
      <state id="p0s2">
        <transition event="event1" target="p0s1">
          <raise event="event2"/>
        </transition>
      </state>
      <state id="p0s3">
        <!--
 this transition should be blocked by the one in p0s2
-->
        <transition event="event1" target="conf:fail"/>
        <!--
 this transition will preempt the one that p0s2 inherits
   from an ancestor  
-->
        <transition event="event2" target="s1"/>
      </state>
      <state id="p0s4">
        <!--
 this transition never gets preempted, should fire twice 
-->
        <transition event="*">
          <script>val1 := val1 + 1</script>
        </transition>
      </state>
    </parallel>
  </state>
  <state id="s1">
    <transition cond="val1 == 2" target="conf:pass"/>
    <transition target="conf:fail"/>
  </state>
  <state id="conf:pass"/>
  <state id="conf:fail"/>
</scxml>
